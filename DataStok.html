<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Data Stok Ruko</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">

  <!-- Font Awesome untuk ikon -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    .booking-row { background-color: #fff3cd; }     /* kuning */
    .available-row { background-color: #d4edda; }    /* hijau */
    .sold-row { background-color: #f8d7da; }         /* merah muda */

    td i { margin-right: 5px; }
  </style>
</head>
<body>
  <div class="container mt-5">
    <h2 class="mb-4">ðŸ“¦ Data Stok Ruko</h2>
    <div class="table-responsive">
      <table id="stokTable" class="table table-bordered table-hover">
        <thead class="table-dark">
          <tr>
            <th>Kode Type</th>
            <th>Nama Pembeli</th>
            <th>Type Ruko</th>
            <th>Ukuran</th>
            <th>Blok/Nomor</th>
            <th>Harga</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="stokBody"></tbody>
      </table>
    </div>
  </div>

  <!-- JS LIBRARY -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>

  <script>
    const url = 'https://script.google.com/macros/s/AKfycbxVgwRqAqmKBXnhetkZ2g3JbXofSPFy3oQxh1b9mln1OoinsUzjjoD2Fxf3F6JTKH6ZtA/exec?sheet=DataStok';

    function formatRupiah(angka) {
      return new Intl.NumberFormat('id-ID', {
        style: 'currency',
        currency: 'IDR',
        minimumFractionDigits: 0
      }).format(angka);
    }

    function getTypeIcon(KodeType) {
      const lower = KodeType?.toLowerCase() || "";
      if (lower.includes("RH 34")) return `<i class="fas fa-gem text-primary"></i> ${KodeType}`;
      if (lower.includes("RR 34")) return `<i class="fas fa-store text-secondary"></i> ${KodeType}`;
      if (lower.includes("RHM 33")) return `<i class="fas fa-building text-warning"></i> ${KodeType}`;
	  if (lower.includes("RR 33")) return `<i class="fas fa-building text-warning"></i> ${KodeType}`;
	  if (lower.includes("L 33")) return `<i class="fas fa-building text-warning"></i> ${KodeType}`;
      return `<i class="fas fa-box text-muted"></i> ${KodeType}`;
    }

    function getStatusBadge(Status) {
      const lower = Status?.toLowerCase() || "";
      if (lower === "booking") return `<span class="badge bg-warning text-dark"><i class="fas fa-clock"></i> Booking</span>`;
      if (lower === "terjual") return `<span class="badge bg-danger"><i class="fas fa-times-circle"></i> Terjual</span>`;
      return `<span class="badge bg-success"><i class="fas fa-check-circle"></i> Tersedia</span>`;
    }

    fetch(url)
      .then(res => res.json())
      .then(data => {
        const tbody = document.getElementById('stokBody');

        for (let i = 1; i < data.length; i++) {
          const row = data[i];
          const tr = document.createElement('tr');

          const status = (row["Status"] || '').trim().toLowerCase();
          if (status === 'Booking') tr.classList.add('booking-row');
          else if (status === 'Terjual') tr.classList.add('sold-row');
          else tr.classList.add('available-row');

          const kolom = [
            row["KodeType"],
            row["NamaPembeli"],
            getTypeIcon(row["TypeRuko"]),
            row["Ukuran"],
            row["BlokNomor"],
            row["Harga"] ? formatRupiah(row["Harga"]) : '-',
            getStatusBadge(row["Status"])
          ];

          kolom.forEach(cell => {
            const td = document.createElement('td');
            td.innerHTML = cell || '-';
            tr.appendChild(td);
          });

          tbody.appendChild(tr);
        }

        // Aktifkan DataTables setelah data dimuat
        $('#stokTable').DataTable({
          language: {
            url: '//cdn.datatables.net/plug-ins/1.13.4/i18n/id.json'
          }
        });
      })
      .catch(error => {
        console.error('Gagal mengambil data:', error);
      });
  </script>
</body>
</html>
